# 2026-02-05 작업 기록

## 요약
- 총 작업 수: 4개 (계층적 추론 파이프라인 구축, 데이터 누수 방지, 서빙 시스템 고도화, 검증)
- 총 변경 파일: 6개
- 주요 사항: Stage 1,2,3 분류 정확도 향상을 위한 Hierarchical 접근 방식 구현 및 검증

---

## 작업 1: 계층적 추론 파이프라인 (Hierarchical Inference) 구축

### 무엇을
- 대상: `table_data` 디렉토리 구조 및 모델링 스크립트
- 범위: 3-Class 분류 문제를 2단계(Binary Cascade)로 분리

### 어떻게
- 방법: 
    1. **Stage 3 vs (1+2)** 분류 (S12_vs_S3)
    2. **Stage 2 vs 1** 분류 (S1_vs_S2)
- 도구: Python, Scikit-learn, Pandas

### 왜
- 배경: 클래스 불균형과 Stage 간의 애매한 경계로 인해 단순 3-Class 분류의 성능 한계
- 목적: 위급한 Stage 3를 먼저 정확히 걸러내고, 남은 데이터에서 초기 진행 단계를 세밀하게 구분

### 결과
- `06_global_inference.py` 생성: 두 단계 모델을 연결하여 최종 추론 수행
- 계층적 모델 구조 확립

---

## 작업 2: 데이터 누수(Data Leakage) 방지

### 무엇을
- 대상: `S1_vs_S2/01_build_datasets.py`
- 범위: 데이터 분할 로직 수정

### 어떻게
- 방법: "필터링 후 분할" 방식에서 **"전체 데이터 분할(Seed 42) 후 필터링"** 방식으로 변경
- 코드: `Global Split -> Filter` 흐름 적용

### 왜
- 배경: Stage 1,2만 뽑아서 다시 Split을 할 경우, Global Test Set과 섞일 위험 존재 (Data Leakage)
- 목적: 전체 파이프라인의 평가 신뢰성 확보

### 결과
- `01_build_datasets.py` 수정 완료: Global Test Set의 순수성 보장

---

## 작업 3: 서빙 시스템 고도화

### 무엇을
- 대상: `serving.py`
- 범위: Fast API 서버 로직 및 UI

### 어떻게
- 방법:
    1. 계층적 추론 로직(Cascade) API 이식
    2. 상세 확률(P3, P2, P1) 출력 기능 추가
    3. SHAP 설명 모델을 상황(S3 or S2)에 맞게 동적으로 선택하도록 수정
- 도구: FastAPI, Jinja2, SHAP, LightGBM

### 왜
- 배경: 단일 모델 서빙에서 계층적 모델 서빙으로 변경 필요
- 목적: 실제 사용자에게 더 상세하고 정확한 진단 결과 제공

### 결과
- `serving.py` 업데이트 완료
- 웹 UI에서 단계별 확률 시각화 제공

---

## 작업 4: 검증 및 테스트

### 무엇을
- 대상: 모델 추론 및 서버 동작 검증
- 범위: 터미널 실행 및 HTTP 요청 테스트

### 어떻게
- 방법:
    - 터미널 명령으로 모델 생성 파이프라인 검증
    - `test_serving.py` 스크립트를 통한 API 응답 코드 검증
- 도구: requests, python

### 왜
- 배경: 서버 환경 문제로 브라우저 자동 테스트 불가
- 목적: 배포 전 기능 정상 동작 확인

### 결과
- `test_serving.py` 생성 및 테스트 성공 (Status 200 OK)
- 터미널 직접 실행 가이드 제공
